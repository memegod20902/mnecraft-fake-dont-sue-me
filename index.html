using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.SceneManagement;
using UnityEngine.UI;

public class VoxelEngine : MonoBehaviour
{
    public int width = 16;
    public int height = 16;
    public int depth = 16;
    public GameObject blockPrefab;
    public GameObject playerPrefab;
    public GameObject titleScreen;
    public Texture blockTexture; // Texture for blocks
    public GameObject usernamePrefab; // Username display prefab
    public Texture playerSkin; // Player skin texture

    private Dictionary<Vector3Int, GameObject> blocks = new Dictionary<Vector3Int, GameObject>();
    private GameObject player;
    private CharacterController controller;
    public float speed = 5f;
    public float jumpForce = 5f;
    private float gravity = -9.81f;
    private Vector3 velocity;
    private GameObject usernameDisplay;
    public string playerName = "Player";

    void Start()
    {
        ShowTitleScreen();
    }

    void ShowTitleScreen()
    {
        titleScreen.SetActive(true);
        Time.timeScale = 0f;
    }

    public void StartGame()
    {
        titleScreen.SetActive(false);
        Time.timeScale = 1f;
        GenerateTerrain();
        SpawnPlayer();
    }

    void GenerateTerrain()
    {
        for (int x = 0; x < width; x++)
        {
            for (int y = 0; y < height; y++)
            {
                for (int z = 0; z < depth; z++)
                {
                    if (y == 0) // Simple ground level
                    {
                        Vector3Int position = new Vector3Int(x, y, z);
                        GameObject block = Instantiate(blockPrefab, position, Quaternion.identity);
                        if (blockTexture != null)
                        {
                            block.GetComponent<Renderer>().material.mainTexture = blockTexture;
                        }
                        blocks.Add(position, block);
                    }
                }
            }
        }
    }

    void SpawnPlayer()
    {
        Vector3 spawnPosition = new Vector3(width / 2, height + 2, depth / 2);
        player = Instantiate(playerPrefab, spawnPosition, Quaternion.identity);
        controller = player.GetComponent<CharacterController>();

        // Apply player skin (If player prefab includes a mesh renderer)
        if (playerSkin != null)
        {
            Renderer playerRenderer = player.GetComponent<Renderer>();
            if (playerRenderer != null)
            {
                playerRenderer.material.mainTexture = playerSkin;
            }
        }

        // Create username display
        usernameDisplay = Instantiate(usernamePrefab, player.transform);
        usernameDisplay.transform.localPosition = new Vector3(0, 2, 0);
        usernameDisplay.GetComponent<TextMesh>().text = playerName;
    }

    void Update()
    {
        if (player != null)
        {
            PlayerMovement();
        }

        if (Input.GetMouseButtonDown(0) || Input.GetButtonDown("Fire1") || Input.GetKeyDown(KeyCode.E)) // Left click, Controller Button, or Keyboard Key
        {
            Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
            RaycastHit hit;
            if (Physics.Raycast(ray, out hit))
            {
                Vector3Int hitPosition = Vector3Int.RoundToInt(hit.point - hit.normal * 0.5f);
                if (blocks.ContainsKey(hitPosition))
                {
                    Destroy(blocks[hitPosition]);
                    blocks.Remove(hitPosition);
                }
            }
        }

        if (Input.GetMouseButtonDown(1) || Input.GetButtonDown("Fire2") || Input.GetKeyDown(KeyCode.Q)) // Right click, Controller Button, or Keyboard Key
        {
            Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
            RaycastHit hit;
            if (Physics.Raycast(ray, out hit))
            {
                Vector3Int placePosition = Vector3Int.RoundToInt(hit.point + hit.normal * 0.5f);
                if (!blocks.ContainsKey(placePosition))
                {
                    GameObject block = Instantiate(blockPrefab, placePosition, Quaternion.identity);
                    if (blockTexture != null)
                    {
                        block.GetComponent<Renderer>().material.mainTexture = blockTexture;
                    }
                    blocks.Add(placePosition, block);
                }
            }
        }
    }

    void PlayerMovement()
    {
        float moveX = Input.GetAxis("Horizontal") + Input.GetAxis("Joystick X") + Input.GetAxis("GamepadLeftX");
        float moveZ = Input.GetAxis("Vertical") + Input.GetAxis("Joystick Y") + Input.GetAxis("GamepadLeftY");
        Vector3 move = transform.right * moveX + transform.forward * moveZ;
        controller.Move(move * speed * Time.deltaTime);

        if ((Input.GetButtonDown("Jump") || Input.GetButtonDown("JoystickJump") || Input.GetKeyDown(KeyCode.Space) || Input.GetButtonDown("GamepadA")) && controller.isGrounded)
        {
            velocity.y = Mathf.Sqrt(jumpForce * -2f * gravity);
        }

        velocity.y += gravity * Time.deltaTime;
        controller.Move(velocity * Time.deltaTime);
    }
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Minecraft-like Game</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Set up the scene
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Set up controls (mouse, keyboard, etc.)
        var controls = new THREE.OrbitControls(camera, renderer.domElement);
        
        // Block Material and Geometry
        var blockGeometry = new THREE.BoxGeometry(1, 1, 1);
        var blockMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });

        // A function to place a block where the mouse hits
        var blocks = [];
        function placeBlock(event) {
            var mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            var raycaster = new THREE.Raycaster();
            raycaster.update(camera);
            raycaster.setFromCamera(mouse, camera);
            
            var intersects = raycaster.intersectObject(scene, true);
            if (intersects.length > 0) {
                var position = intersects[0].point;
                var block = new THREE.Mesh(blockGeometry, blockMaterial);
                block.position.copy(position).add(intersects[0].face.normal);
                scene.add(block);
                blocks.push(block);
            }
        }

        // Listen to mouse clicks
        window.addEventListener('click', placeBlock);

        // Camera setup
        camera.position.z = 5;

        // Animation loop
        var animate = function () {
            requestAnimationFrame(animate);

            controls.update(); // Update controls

            renderer.render(scene, camera);
        };

        animate();
    </script>
</body>
</html>

var texture = new THREE.TextureLoader().load('block_texture.jpg');
var blockMaterial = new THREE.MeshBasicMaterial({ map: texture });

 var light = new THREE.AmbientLight(0x404040); // Ambient light
scene.add(light);
                           
